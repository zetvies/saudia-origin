<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saudia Quiz Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'saudia-green': '#006400',
                        'saudia-light-green': '#228B22',
                        'saudia-blue': '#87CEEB',
                        'saudia-light-blue': '#98FB98'
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-saudia-blue to-saudia-light-blue flex items-center justify-center text-saudia-green relative overflow-hidden p-5">
    <!-- Geometric patterns -->
    <div class="absolute top-0 left-0 w-48 h-48 bg-gradient-to-br from-saudia-green via-saudia-light-green to-green-500 opacity-10 z-10" style="clip-path: polygon(0 0, 100% 0, 50% 100%);"></div>
    <div class="absolute bottom-0 right-0 w-36 h-36 bg-gradient-to-br from-saudia-green via-saudia-light-green to-green-500 opacity-10 z-10" style="clip-path: polygon(50% 0, 100% 50%, 50% 100%, 0 50%);"></div>
    
        <!-- Game Title and Start Screen -->
        <div id="startScreen" class="text-center bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border-2 border-saudia-green/20 max-w-4xl w-full relative z-20">
            <h1 class="text-4xl md:text-5xl font-bold mb-6 bg-gradient-to-r from-saudia-green to-saudia-light-green bg-clip-text text-transparent">ðŸŽ® Saudia Quiz Game</h1>
            <p class="text-lg text-saudia-green/80 mb-8">Test your knowledge about your travel Destinations!</p>
            <button id="startBtn" class="bg-gradient-to-r from-saudia-green to-saudia-light-green text-white px-8 py-4 rounded-2xl text-xl font-bold hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
                Mulai Game
            </button>
        </div>

        <!-- Countdown Screen -->
        <div id="countdownScreen" class="hidden text-center bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border-2 border-saudia-green/20 max-w-4xl w-full relative z-20">
            <h2 class="text-3xl font-bold text-saudia-green mb-4">Game akan dimulai dalam:</h2>
            <div id="countdownTimer" class="text-6xl font-bold text-saudia-green">3</div>
        </div>

                                                <!-- Game Screen -->
                    <div id="gameScreen" class="hidden w-full h-screen flex items-center justify-center">
                        <!-- Square Game Container (80svh, 1:1 aspect ratio) -->
                        <div class="w-[80svh] h-[80svh] bg-white rounded-lg shadow-lg border-2 border-saudia-green/20 overflow-hidden">
                            <!-- Level and Timer (inside square) -->
                            <div class="flex justify-between items-center p-4 bg-saudia-green/10 h-16">
                                <div class="text-lg font-bold text-saudia-green">Level: <span id="currentLevel">1</span>/6</div>
                                <div class="text-lg font-bold text-saudia-green">Waktu: <span id="gameTimer">30</span>s</div>
                            </div>
                            
                            <!-- Question Section (remaining height minus answer section) -->
                            <div class="flex-1 p-4 flex items-center justify-center min-h-0">
                                <img id="questionImage" src="" alt="Question" class="w-full h-[50svh] object-contain rounded-lg transition-opacity duration-300">
                            </div>
                            
                            <!-- Answer Section (fixed height) -->
                            <div class="h-24 flex items-center justify-center gap-2 px-4 pb-4">
                                <button class="answer-btn flex-1 h-fit bg-white border-2 border-saudia-green/30 hover:bg-saudia-green/10 hover:border-saudia-green/50 transition-all duration-300 rounded-lg flex items-center justify-center" data-answer="0">
                                    <img class="w-full h-auto object-contain rounded transition-opacity duration-300" alt="Answer 1">
                                </button>
                                <button class="answer-btn flex-1 h-fit bg-white border-2 border-saudia-green/30 hover:bg-saudia-green/10 hover:border-saudia-green/50 transition-all duration-300 rounded-lg flex items-center justify-center" data-answer="1">
                                    <img class="w-full h-auto object-contain rounded transition-opacity duration-300" alt="Answer 2">
                                </button>
                                <button class="answer-btn flex-1 h-fit bg-white border-2 border-saudia-green/30 hover:bg-saudia-green/10 hover:border-saudia-green/50 transition-all duration-300 rounded-lg flex items-center justify-center" data-answer="2">
                                    <img class="w-full h-auto object-contain rounded transition-opacity duration-300" alt="Answer 3">
                                </button>
                                <button class="answer-btn flex-1 h-fit bg-white border-2 border-saudia-green/30 hover:bg-saudia-green/10 hover:border-saudia-green/50 transition-all duration-300 rounded-lg flex items-center justify-center" data-answer="3">
                                    <img class="w-full h-auto object-contain rounded transition-opacity duration-300" alt="Answer 4">
                                </button>
                            </div>
                        </div>
                    </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="hidden text-center bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border-2 border-saudia-green/20 max-w-4xl w-full relative z-20">
            <h2 class="text-3xl font-bold text-saudia-green mb-6">ðŸŽ‰ Game Selesai!</h2>
            <div class="text-xl text-saudia-green mb-4">Skor Anda: <span id="finalScore" class="font-bold">0</span>/6</div>
            <div class="text-lg text-saudia-green mb-6">Waktu Tersisa: <span id="gameDuration" class="font-bold">0</span> detik</div>
            <p class="text-sm text-saudia-green/70">Kembali ke halaman utama dalam <span id="redirectTimer">5</span> detik...</p>
        </div>

    <script>
        // Game state
        let gameState = 'start'; // start, countdown, playing, gameOver
        let currentLevel = 1;
        let score = 0;
        let gameStartTime = 0;
        let totalTimeUsed = 0;
        let countdownInterval;
        let gameTimerInterval;
        let redirectInterval;

        // Game data with image paths
        const gameData = [
            {
                questionImage: "assets/images/1-Question.png",
                correctAnswerImage: "assets/images/1-Answer.png",
                correct: 0 // Will be randomized
            },
            {
                questionImage: "assets/images/2-Question.png",
                correctAnswerImage: "assets/images/2-Answer.png",
                correct: 0 // Will be randomized
            },
            {
                questionImage: "assets/images/3-Question.png",
                correctAnswerImage: "assets/images/3-Answer.png",
                correct: 0 // Will be randomized
            },
            {
                questionImage: "assets/images/4-Question.png",
                correctAnswerImage: "assets/images/4-Answer.png",
                correct: 0 // Will be randomized
            },
            {
                questionImage: "assets/images/5-Question.png",
                correctAnswerImage: "assets/images/5-Answer.png",
                correct: 0 // Will be randomized
            },
            {
                questionImage: "assets/images/6-Question.png",
                correctAnswerImage: "assets/images/6-Answer.png",
                correct: 0 // Will be randomized
            }
        ];

        // DOM elements
        const startScreen = document.getElementById('startScreen');
        const countdownScreen = document.getElementById('countdownScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startBtn = document.getElementById('startBtn');
        const countdownTimer = document.getElementById('countdownTimer');
        const currentLevelSpan = document.getElementById('currentLevel');
        const gameTimerSpan = document.getElementById('gameTimer');
        const questionImage = document.getElementById('questionImage');
        const answerBtns = document.querySelectorAll('.answer-btn');
        const finalScore = document.getElementById('finalScore');
        const gameDuration = document.getElementById('gameDuration');
        const redirectTimer = document.getElementById('redirectTimer');

        // Utility function to shuffle array
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Event listeners
        startBtn.addEventListener('click', startGame);
        answerBtns.forEach(btn => btn.addEventListener('click', handleAnswer));

        // Game functions
        function startGame() {
            gameState = 'countdown';
            startScreen.classList.add('hidden');
            countdownScreen.classList.remove('hidden');
            
            let countdown = 3;
            countdownTimer.textContent = countdown;
            
            countdownInterval = setInterval(() => {
                countdown--;
                countdownTimer.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    startPlaying();
                }
            }, 1000);
        }

        function startPlaying() {
            gameState = 'playing';
            countdownScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            gameStartTime = Date.now();
            currentLevel = 1;
            score = 0;
            totalTimeUsed = 0;
            
            loadLevel();
            startGameTimer();
        }

        function loadLevel() {
            if (currentLevel > gameData.length) {
                endGame();
                return;
            }

            const levelData = gameData[currentLevel - 1];
            currentLevelSpan.textContent = currentLevel;
            
            // Create array of all answer images
            const allAnswerImages = [
                "assets/images/1-Answer.png",
                "assets/images/2-Answer.png", 
                "assets/images/3-Answer.png",
                "assets/images/4-Answer.png",
                "assets/images/5-Answer.png",
                "assets/images/6-Answer.png"
            ];
            
            // Remove the correct answer from the pool
            const otherAnswers = allAnswerImages.filter(img => img !== levelData.correctAnswerImage);
            
            // Randomly select 3 wrong answers
            const shuffledWrongAnswers = shuffleArray(otherAnswers).slice(0, 3);
            
            // Add correct answer and shuffle all 4 answers
            const allAnswers = [...shuffledWrongAnswers, levelData.correctAnswerImage];
            const shuffledAnswers = shuffleArray(allAnswers);
            
            // Track loading progress
            let imagesLoaded = 0;
            const totalImages = 5; // 1 question + 4 answers
            
            function onImageLoad() {
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    // All images loaded, enable buttons and show content
                    answerBtns.forEach(btn => {
                        btn.classList.remove('bg-green-500', 'bg-red-500');
                        btn.classList.add('bg-white');
                        btn.disabled = false;
                    });
                }
            }
            
            // Load question image
            questionImage.onload = onImageLoad;
            questionImage.src = levelData.questionImage;
            
            // Load answer images
            answerBtns.forEach((btn, index) => {
                const img = btn.querySelector('img');
                img.onload = onImageLoad;
                img.src = shuffledAnswers[index];
                btn.dataset.answer = index;
                
                // Initially disable buttons and show loading state
                btn.disabled = true;
                btn.classList.remove('bg-green-500', 'bg-red-500', 'bg-white');
                btn.classList.add('bg-gray-200');
            });
        }

        function startGameTimer() {
            // Calculate remaining time from total 30 seconds
            let timeLeft = 30 - totalTimeUsed;
            gameTimerSpan.textContent = timeLeft;
            
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                totalTimeUsed++;
                gameTimerSpan.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(gameTimerInterval);
                    handleTimeout();
                }
            }, 1000);
        }

        function handleAnswer(event) {
            // Ensure we get the button element, not the image
            const selectedButton = event.target.closest('.answer-btn') || event.target;
            const selectedImg = selectedButton.querySelector('img');
            
            if (!selectedImg) {
                console.error('No image found in button');
                return;
            }
            
            const selectedImageSrc = selectedImg.src;
            const correctAnswerImage = gameData[currentLevel - 1].correctAnswerImage;
            
            // Disable all buttons
            answerBtns.forEach(btn => btn.disabled = true);
            
            // Show correct/incorrect based on image source
            if (selectedImageSrc.includes(correctAnswerImage.split('/').pop())) {
                selectedButton.classList.remove('bg-white');
                selectedButton.classList.add('bg-green-500');
                score++;
            } else {
                selectedButton.classList.remove('bg-white');
                selectedButton.classList.add('bg-red-500');
                
                // Show correct answer by finding the button with correct image
                answerBtns.forEach(btn => {
                    const img = btn.querySelector('img');
                    if (img && img.src.includes(correctAnswerImage.split('/').pop())) {
                        btn.classList.remove('bg-white');
                        btn.classList.add('bg-green-500');
                    }
                });
            }
            
            // Wait 1 second for visual feedback, then transition to next level
            setTimeout(() => {
                // Fade out current question and answer images
                questionImage.style.opacity = '0';
                answerBtns.forEach(btn => {
                    const img = btn.querySelector('img');
                    img.style.opacity = '0';
                });
                
                setTimeout(() => {
                    currentLevel++;
                    clearInterval(gameTimerInterval);
                    
                    // Load new level content first
                    loadLevel();
                    
                    // Wait for all images to load before starting timer and fading in
                    const checkImagesLoaded = () => {
                        const questionLoaded = questionImage.complete && questionImage.naturalHeight !== 0;
                        const answersLoaded = Array.from(answerBtns).every(btn => {
                            const img = btn.querySelector('img');
                            return img.complete && img.naturalHeight !== 0;
                        });
                        
                        if (questionLoaded && answersLoaded) {
                            // All images loaded, start timer and fade in
                            startGameTimer();
                            questionImage.style.opacity = '1';
                            answerBtns.forEach(btn => {
                                const img = btn.querySelector('img');
                                img.style.opacity = '1';
                            });
                        } else {
                            // Check again in 50ms
                            setTimeout(checkImagesLoaded, 50);
                        }
                    };
                    
                    checkImagesLoaded();
                }, 300);
            }, 1000);
        }

        function handleTimeout() {
            // When timeout occurs, the remaining time becomes 0, so totalTimeUsed becomes 30
            totalTimeUsed = 30;
            endGame();
        }

        function endGame() {
            gameState = 'gameOver';
            gameScreen.classList.add('hidden');
            gameOverScreen.classList.remove('hidden');
            
            // Calculate remaining time from total 30 seconds
            const remainingTime = 30 - totalTimeUsed;
            
            finalScore.textContent = score;
            gameDuration.textContent = remainingTime;
            
            // Redirect after 5 seconds
            let redirectCountdown = 10;
            redirectTimer.textContent = redirectCountdown;
            
            redirectInterval = setInterval(() => {
                redirectCountdown--;
                redirectTimer.textContent = redirectCountdown;
                
                if (redirectCountdown <= 0) {
                    clearInterval(redirectInterval);
                    window.location.href = '/';
                }
            }, 1000);
        }
    </script>
</body>
</html>
